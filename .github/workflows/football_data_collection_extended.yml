# .github/workflows/football_data_collection_extended.yml
name: Football Extended Data Collection (10 nouvelles ligues)

# D√©clenchement manuel uniquement pour cette collecte compl√®te
on:
  workflow_dispatch:  # Permet de lancer manuellement le workflow

jobs:
  collect-data:
    runs-on: ubuntu-latest
    
    steps:
    # √âtape 1: Checkout du code
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        persist-credentials: true
    
    # √âtape 2: Configuration de Python
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    # √âtape 3: Installation des d√©pendances
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests pandas
    
    # √âtape 4: Cr√©ation du dossier data
    - name: Create data directory
      run: mkdir -p data
    
    # √âtape 5: Ex√©cution du script de collecte √©tendu
    - name: Run extended football data collection
      env:
        RAPIDAPI_KEY: ${{ secrets.RAPIDAPI_KEY }}
      run: |
        python football_data_collector_extended.py
    
    # √âtape 6: Commit et push des nouveaux fichiers CSV
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add data/*.csv
        git add football_data.log
        
        # V√©rifier s'il y a des changements √† committer
        if git diff --staged --quiet; then
          echo "Aucun changement √† committer"
        else
          git commit -m "üöÄ Collecte nouvelles ligues - 10 ligues europ√©ennes + Saudi Pro League - $(date '+%Y-%m-%d')"
          git push
        fi
    
    # √âtape 7: Upload des logs en cas d'erreur
    - name: Upload logs on failure
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: extended-football-data-logs
        path: football_data.log
    
    # √âtape 8: R√©sum√© des fichiers g√©n√©r√©s
    - name: Display summary
      run: |
        echo "=== R√âSUM√â DE LA COLLECTE √âTENDUE ==="
        echo "Date: $(date)"
        echo "Fichiers g√©n√©r√©s:"
        ls -la data/
        echo ""
        echo "Taille des fichiers:"
        du -h data/*.csv 2>/dev/null || echo "Aucun fichier CSV trouv√©"
        echo ""
        echo "Nombre total de fichiers CSV:"
        ls data/*.csv 2>/dev/null | wc -l
        echo ""
        echo "Derni√®res lignes du log:"
        tail -20 football_data.log 2>/dev/null || echo "Aucun log trouv√©"
